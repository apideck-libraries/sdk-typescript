/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";
import { Apideck } from "../index.js";
import { createTestHTTPClient } from "./testclient.js";

test("Connections Vault Connections All", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsAll");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.list({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    api: "crm",
    configured: true,
  });
  expect(result.httpMeta.response.status).toBe(200);
  expect(result.getConnectionsResponse).toBeDefined();
  expect(result.getConnectionsResponse).toEqual({
    statusCode: 200,
    status: "OK",
    data: [
      {
        id: "crm+salesforce",
        serviceId: "salesforce",
        name: "Salesforce",
        tagLine:
          "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
        unifiedApi: "crm",
        state: "authorized",
        integrationState: "configured",
        authType: "oauth2",
        oauthGrantType: "authorization_code",
        enabled: true,
        website: "https://www.salesforce.com",
        icon:
          "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
        logo:
          "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
        authorizeUrl:
          "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
        revokeUrl:
          "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
        settings: {
          "instance_url": "https://eu28.salesforce.com",
          "api_key": "12345xxxxxx",
        },
        metadata: {
          "account": {
            "name": "My Company",
            "id": "c01458a5-7276-41ce-bc19-639906b0450a",
          },
          "plan": "enterprise",
        },
        formFields: [
          {
            id: "instance_url",
            label: "Instance url",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: false,
          },
          {
            id: "api_key",
            label: "API Key",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: true,
          },
        ],
        configuration: [
          {
            resource: "leads",
            defaults: [
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                ],
                value: true,
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: true,
                    optionType: "simple",
                  },
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                ],
                value: true,
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [],
                    optionType: "group",
                  },
                  {
                    label: "General Channel",
                    value: 123,
                    optionType: "simple",
                  },
                ],
                value: 10.5,
              },
            ],
          },
          {
            resource: "leads",
            defaults: [
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: 12.5,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: "general",
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 123,
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [],
                    optionType: "group",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: [
                          "team",
                          "general",
                        ],
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                ],
                value: "GC5000 series",
              },
            ],
          },
        ],
        configurableResources: [
          "opportunities",
          "companies",
          "contacts",
          "leads",
        ],
        resourceSchemaSupport: [
          "leads",
        ],
        resourceSettingsSupport: [
          "leads",
        ],
        settingsRequiredForAuthorization: [
          "client_id",
          "client_secret",
        ],
        subscriptions: [
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
        ],
        hasGuide: true,
        createdAt: 1615563533390,
        customMappings: [
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
        ],
        updatedAt: 1616662325753,
      },
      {
        id: "crm+salesforce",
        serviceId: "salesforce",
        name: "Salesforce",
        tagLine:
          "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
        unifiedApi: "crm",
        state: "authorized",
        integrationState: "configured",
        authType: "oauth2",
        oauthGrantType: "authorization_code",
        enabled: true,
        website: "https://www.salesforce.com",
        icon:
          "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
        logo:
          "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
        authorizeUrl:
          "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
        revokeUrl:
          "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
        settings: {
          "instance_url": "https://eu28.salesforce.com",
          "api_key": "12345xxxxxx",
        },
        metadata: {
          "account": {
            "name": "My Company",
            "id": "c01458a5-7276-41ce-bc19-639906b0450a",
          },
          "plan": "enterprise",
        },
        formFields: [
          {
            id: "instance_url",
            label: "Instance url",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: false,
          },
          {
            id: "api_key",
            label: "API Key",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: true,
          },
        ],
        configuration: [
          {
            resource: "leads",
            defaults: [
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: 12.5,
                    optionType: "simple",
                  },
                  {
                    label: "General Channel",
                    value: 12.5,
                    optionType: "simple",
                  },
                ],
                value: [
                  10.5,
                ],
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                ],
                value: "GC5000 series",
              },
            ],
          },
        ],
        configurableResources: [
          "opportunities",
          "companies",
          "contacts",
          "leads",
        ],
        resourceSchemaSupport: [
          "leads",
        ],
        resourceSettingsSupport: [
          "leads",
        ],
        settingsRequiredForAuthorization: [
          "client_id",
          "client_secret",
        ],
        subscriptions: [
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
        ],
        hasGuide: true,
        createdAt: 1615563533390,
        customMappings: [
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
        ],
        updatedAt: 1616662325753,
      },
      {
        id: "crm+salesforce",
        serviceId: "salesforce",
        name: "Salesforce",
        tagLine:
          "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
        unifiedApi: "crm",
        state: "authorized",
        integrationState: "configured",
        authType: "oauth2",
        oauthGrantType: "authorization_code",
        enabled: true,
        website: "https://www.salesforce.com",
        icon:
          "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
        logo:
          "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
        authorizeUrl:
          "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
        revokeUrl:
          "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
        settings: {
          "instance_url": "https://eu28.salesforce.com",
          "api_key": "12345xxxxxx",
        },
        metadata: {
          "account": {
            "name": "My Company",
            "id": "c01458a5-7276-41ce-bc19-639906b0450a",
          },
          "plan": "enterprise",
        },
        formFields: [
          {
            id: "instance_url",
            label: "Instance url",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: false,
          },
          {
            id: "api_key",
            label: "API Key",
            placeholder: "",
            type: "text",
            required: true,
            customField: false,
            allowCustomValues: false,
            disabled: false,
            sensitive: true,
          },
        ],
        configuration: [
          {
            resource: "leads",
            defaults: [
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: true,
                    optionType: "simple",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: [
                          "team",
                          "general",
                        ],
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: [
                          "team",
                          "general",
                        ],
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: "general",
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                ],
                value: [
                  "GC6000 series",
                  10,
                  "GC6000 series",
                ],
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [],
                    optionType: "group",
                  },
                  {
                    label: "General Channel",
                    value: 123,
                    optionType: "simple",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: 123,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 123,
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                ],
                value: "GC5000 series",
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: true,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 12.5,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: [
                          "team",
                          "general",
                        ],
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [],
                    optionType: "group",
                  },
                ],
                value: 10.5,
              },
            ],
          },
          {
            resource: "leads",
            defaults: [
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: "general",
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: true,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 12.5,
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                  {
                    label: "General Channel",
                    value: [
                      "team",
                      "general",
                    ],
                    optionType: "simple",
                  },
                ],
                value: 10,
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                  {
                    id: "1234",
                    label: "General Channel",
                    options: [
                      {
                        label: "General Channel",
                        value: 12.5,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 123,
                        optionType: "simple",
                      },
                      {
                        label: "General Channel",
                        value: 12.5,
                        optionType: "simple",
                      },
                    ],
                    optionType: "group",
                  },
                ],
                value: 10,
              },
              {
                target: "custom_fields",
                id: "ProductInterest",
                options: [
                  {
                    label: "General Channel",
                    value: true,
                    optionType: "simple",
                  },
                  {
                    label: "General Channel",
                    value: "general",
                    optionType: "simple",
                  },
                  {
                    label: "General Channel",
                    value: 123,
                    optionType: "simple",
                  },
                ],
                value: "GC5000 series",
              },
            ],
          },
        ],
        configurableResources: [
          "opportunities",
          "companies",
          "contacts",
          "leads",
        ],
        resourceSchemaSupport: [
          "leads",
        ],
        resourceSettingsSupport: [
          "leads",
        ],
        settingsRequiredForAuthorization: [
          "client_id",
          "client_secret",
        ],
        subscriptions: [
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
          {
            downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
            unifyEventTypes: [
              "crm.contact.created",
            ],
            downstreamEventTypes: [
              "contacts.CREATED",
            ],
            executeUrl:
              "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
            createdAt: "2020-10-01T12:00:00.000Z",
          },
        ],
        hasGuide: true,
        createdAt: 1615563533390,
        customMappings: [
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
          {
            id: "hris+employees+first_aid_training",
            label: "First Aid Training",
            description: "First Aid Training completed after 2019-01-01",
            value: "$.root.training.first_aid",
            key: "first_aid_training",
            required: false,
            customField: true,
            consumerId: "test_user_id",
            example: "Some value",
          },
        ],
        updatedAt: 1616662325753,
      },
    ],
  });
});

test("Connections Vault Connections One", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsOne");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.get({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    serviceId: "pipedrive",
    unifiedApi: "crm",
  });
  expect(result.httpMeta.response.status).toBe(200);
  expect(result.getConnectionResponse).toBeDefined();
  expect(result.getConnectionResponse).toEqual({
    statusCode: 200,
    status: "OK",
    data: {
      id: "crm+salesforce",
      serviceId: "salesforce",
      name: "Salesforce",
      tagLine:
        "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
      unifiedApi: "crm",
      state: "authorized",
      integrationState: "configured",
      authType: "oauth2",
      oauthGrantType: "authorization_code",
      enabled: true,
      website: "https://www.salesforce.com",
      icon:
        "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
      logo:
        "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
      authorizeUrl:
        "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
      revokeUrl:
        "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
      settings: {
        "instance_url": "https://eu28.salesforce.com",
        "api_key": "12345xxxxxx",
      },
      metadata: {
        "account": {
          "name": "My Company",
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
        },
        "plan": "enterprise",
      },
      formFields: [
        {
          id: "instance_url",
          label: "Instance url",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: false,
        },
        {
          id: "api_key",
          label: "API Key",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: true,
        },
      ],
      configuration: [
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: [
                    "team",
                    "general",
                  ],
                  optionType: "simple",
                },
              ],
              value: 10.5,
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: 123,
                  optionType: "simple",
                },
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
              ],
              value: 10.5,
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: 123,
                  optionType: "simple",
                },
              ],
              value: true,
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: [
                        "team",
                        "general",
                      ],
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: [
                    "team",
                    "general",
                  ],
                  optionType: "simple",
                },
                {
                  label: "General Channel",
                  value: 12.5,
                  optionType: "simple",
                },
              ],
              value: "GC5000 series",
            },
          ],
        },
      ],
      configurableResources: [
        "opportunities",
        "companies",
        "contacts",
        "leads",
      ],
      resourceSchemaSupport: [
        "leads",
      ],
      resourceSettingsSupport: [
        "leads",
      ],
      settingsRequiredForAuthorization: [
        "client_id",
        "client_secret",
      ],
      subscriptions: [
        {
          downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
          unifyEventTypes: [
            "crm.contact.created",
          ],
          downstreamEventTypes: [
            "contacts.CREATED",
          ],
          executeUrl:
            "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
          createdAt: "2020-10-01T12:00:00.000Z",
        },
      ],
      hasGuide: true,
      createdAt: 1615563533390,
      customMappings: [
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
      ],
      updatedAt: 1616662325753,
    },
  });
});

test("Connections Vault Connections Update", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsUpdate");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.update({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    serviceId: "pipedrive",
    unifiedApi: "crm",
    connection: {
      enabled: true,
      settings: {
        "api_key": "12345xxxxxx",
        "instance_url": "https://eu28.salesforce.com",
      },
      metadata: {
        "account": {
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
          "name": "My Company",
        },
        "plan": "enterprise",
      },
      configuration: [
        {
          resource: "leads",
          defaults: [
            {
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: [
                        "team",
                        "general",
                      ],
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: [
                    "team",
                    "general",
                  ],
                  optionType: "simple",
                },
              ],
              value: 10.5,
            },
            {
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
              ],
              value: true,
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
              ],
              value: true,
            },
            {
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
              ],
              value: "GC5000 series",
            },
            {
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: [
                    "team",
                    "general",
                  ],
                  optionType: "simple",
                },
              ],
              value: [
                10.5,
                10,
                "GC6000 series",
              ],
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: "general",
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: "general",
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [],
                  optionType: "group",
                },
              ],
              value: true,
            },
            {
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
              ],
              value: true,
            },
          ],
        },
      ],
      customMappings: [
        {
          value: "$.root.training.first_aid",
        },
        {
          value: "$.root.training.first_aid",
        },
      ],
    },
  });
  expect(result.httpMeta.response.status).toBe(200);
  expect(result.updateConnectionResponse).toBeDefined();
  expect(result.updateConnectionResponse).toEqual({
    statusCode: 200,
    status: "OK",
    data: {
      id: "crm+salesforce",
      serviceId: "salesforce",
      name: "Salesforce",
      tagLine:
        "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
      unifiedApi: "crm",
      state: "authorized",
      integrationState: "configured",
      authType: "oauth2",
      oauthGrantType: "authorization_code",
      enabled: true,
      website: "https://www.salesforce.com",
      icon:
        "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
      logo:
        "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
      authorizeUrl:
        "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
      revokeUrl:
        "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
      settings: {
        "instance_url": "https://eu28.salesforce.com",
        "api_key": "12345xxxxxx",
      },
      metadata: {
        "account": {
          "name": "My Company",
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
        },
        "plan": "enterprise",
      },
      formFields: [
        {
          id: "instance_url",
          label: "Instance url",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: false,
        },
        {
          id: "api_key",
          label: "API Key",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: true,
        },
      ],
      configuration: [
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
              ],
              value: 10.5,
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 123,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: 123,
                  optionType: "simple",
                },
                {
                  label: "General Channel",
                  value: 123,
                  optionType: "simple",
                },
              ],
              value: true,
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
              ],
              value: 10.5,
            },
          ],
        },
      ],
      configurableResources: [
        "opportunities",
        "companies",
        "contacts",
        "leads",
      ],
      resourceSchemaSupport: [
        "leads",
      ],
      resourceSettingsSupport: [
        "leads",
      ],
      settingsRequiredForAuthorization: [
        "client_id",
        "client_secret",
      ],
      subscriptions: [
        {
          downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
          unifyEventTypes: [
            "crm.contact.created",
          ],
          downstreamEventTypes: [
            "contacts.CREATED",
          ],
          executeUrl:
            "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
          createdAt: "2020-10-01T12:00:00.000Z",
        },
      ],
      hasGuide: true,
      createdAt: 1615563533390,
      customMappings: [
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
      ],
      updatedAt: 1616662325753,
    },
  });
});

test("Connections Vault Connections Delete", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsDelete");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.delete({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    serviceId: "pipedrive",
    unifiedApi: "crm",
  });
  expect([
    204,
    400,
    401,
    402,
    404,
    422,
    400,
    401,
    402,
    403,
    404,
    405,
    406,
    407,
    408,
    409,
    410,
    411,
    412,
    413,
    414,
    415,
    416,
    417,
    418,
    421,
    422,
    423,
    424,
    425,
    426,
    428,
    429,
    431,
    451,
    500,
    501,
    502,
    503,
    504,
    505,
    506,
    507,
    508,
    510,
    511,
  ]).not.toContain(result.httpMeta.response.status);
  expect(result.unexpectedErrorResponse).toBeDefined();
  expect(result.unexpectedErrorResponse).toEqual({
    statusCode: 400,
    error: "Bad Request",
    typeName: "RequestHeadersValidationError",
    message: "Invalid Params",
    detail: {
      "missing": [
        {
          "x-apideck-consumer-id": "required",
        },
      ],
    },
    ref: "https://developers.apideck.com/errors#unauthorizederror",
  });
});

test("Connections Vault Connections Import", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsImport");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.imports({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    serviceId: "pipedrive",
    unifiedApi: "crm",
    connectionImportData: {
      credentials: {
        refreshToken:
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.cThIIoDvwdueQB468K5xDc5633seEFoqwxjF_xSJyQQ",
        accessToken:
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
      },
      metadata: {
        "account": {
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
          "name": "My Company",
        },
        "plan": "enterprise",
      },
    },
  });
  expect(result.httpMeta.response.status).toBe(200);
  expect(result.createConnectionResponse).toBeDefined();
  expect(result.createConnectionResponse).toEqual({
    statusCode: 201,
    status: "OK",
    data: {
      id: "crm+salesforce",
      serviceId: "salesforce",
      name: "Salesforce",
      tagLine:
        "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
      unifiedApi: "crm",
      state: "authorized",
      integrationState: "configured",
      authType: "oauth2",
      oauthGrantType: "authorization_code",
      enabled: true,
      website: "https://www.salesforce.com",
      icon:
        "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
      logo:
        "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
      authorizeUrl:
        "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
      revokeUrl:
        "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
      settings: {
        "instance_url": "https://eu28.salesforce.com",
        "api_key": "12345xxxxxx",
      },
      metadata: {
        "account": {
          "name": "My Company",
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
        },
        "plan": "enterprise",
      },
      formFields: [
        {
          id: "instance_url",
          label: "Instance url",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: false,
        },
        {
          id: "api_key",
          label: "API Key",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: true,
        },
      ],
      configuration: [
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
              ],
              value: 10,
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: [
                        "team",
                        "general",
                      ],
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: "general",
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
                {
                  label: "General Channel",
                  value: 123,
                  optionType: "simple",
                },
              ],
              value: 10,
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: "general",
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [],
                  optionType: "group",
                },
              ],
              value: "GC5000 series",
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: [
                    "team",
                    "general",
                  ],
                  optionType: "simple",
                },
              ],
              value: "GC5000 series",
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: true,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                    {
                      label: "General Channel",
                      value: 12.5,
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
                {
                  id: "1234",
                  label: "General Channel",
                  options: [
                    {
                      label: "General Channel",
                      value: [
                        "team",
                        "general",
                      ],
                      optionType: "simple",
                    },
                  ],
                  optionType: "group",
                },
              ],
              value: [
                10,
              ],
            },
          ],
        },
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: "general",
                  optionType: "simple",
                },
              ],
              value: [
                "GC6000 series",
                10.5,
                10,
              ],
            },
          ],
        },
      ],
      configurableResources: [
        "opportunities",
        "companies",
        "contacts",
        "leads",
      ],
      resourceSchemaSupport: [
        "leads",
      ],
      resourceSettingsSupport: [
        "leads",
      ],
      settingsRequiredForAuthorization: [
        "client_id",
        "client_secret",
      ],
      subscriptions: [
        {
          downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
          unifyEventTypes: [
            "crm.contact.created",
          ],
          downstreamEventTypes: [
            "contacts.CREATED",
          ],
          executeUrl:
            "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
          createdAt: "2020-10-01T12:00:00.000Z",
        },
      ],
      hasGuide: true,
      createdAt: 1615563533390,
      customMappings: [
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
      ],
      updatedAt: 1616662325753,
    },
  });
});

test("Connections Vault Connections Token", async () => {
  const testHttpClient = createTestHTTPClient("vault.connectionsToken");

  const apideck = new Apideck({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    apiKey: process.env["APIDECK_API_KEY"] ?? "value",
  });

  const result = await apideck.vault.connections.token({
    consumerId: "test-consumer",
    appId: "dSBdXd2H6Mqwfg0atXHXYcysLJE9qyn1VwBtXHX",
    serviceId: "pipedrive",
    unifiedApi: "crm",
  });
  expect(result.httpMeta.response.status).toBe(200);
  expect(result.getConnectionResponse).toBeDefined();
  expect(result.getConnectionResponse).toEqual({
    statusCode: 200,
    status: "OK",
    data: {
      id: "crm+salesforce",
      serviceId: "salesforce",
      name: "Salesforce",
      tagLine:
        "CRM software solutions and enterprise cloud computing from Salesforce, the leader in customer relationship management (CRM) and PaaS. Free 30 day trial.",
      unifiedApi: "crm",
      state: "authorized",
      integrationState: "configured",
      authType: "oauth2",
      oauthGrantType: "authorization_code",
      enabled: true,
      website: "https://www.salesforce.com",
      icon:
        "https://res.cloudinary.com/apideck/image/upload/v1529456047/catalog/salesforce/icon128x128.png",
      logo:
        "https://c1.sfdcstatic.com/content/dam/web/en_us/www/images/home/logo-salesforce-m.svg",
      authorizeUrl:
        "https://unify.apideck.com/vault/authorize/salesforce/<application-id>?state=<state>",
      revokeUrl:
        "https://unify.apideck.com/vault/revoke/salesforce/<application-id>?state=<state>",
      settings: {
        "instance_url": "https://eu28.salesforce.com",
        "api_key": "12345xxxxxx",
      },
      metadata: {
        "account": {
          "name": "My Company",
          "id": "c01458a5-7276-41ce-bc19-639906b0450a",
        },
        "plan": "enterprise",
      },
      formFields: [
        {
          id: "instance_url",
          label: "Instance url",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: false,
        },
        {
          id: "api_key",
          label: "API Key",
          placeholder: "",
          type: "text",
          required: true,
          customField: false,
          allowCustomValues: false,
          disabled: false,
          sensitive: true,
        },
      ],
      configuration: [
        {
          resource: "leads",
          defaults: [
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
              ],
              value: [],
            },
            {
              target: "custom_fields",
              id: "ProductInterest",
              options: [
                {
                  label: "General Channel",
                  value: true,
                  optionType: "simple",
                },
              ],
              value: "GC5000 series",
            },
          ],
        },
      ],
      configurableResources: [
        "opportunities",
        "companies",
        "contacts",
        "leads",
      ],
      resourceSchemaSupport: [
        "leads",
      ],
      resourceSettingsSupport: [
        "leads",
      ],
      settingsRequiredForAuthorization: [
        "client_id",
        "client_secret",
      ],
      subscriptions: [
        {
          downstreamId: "5f5f5f5f5f5f5f5f5f5f5f5f",
          unifyEventTypes: [
            "crm.contact.created",
          ],
          downstreamEventTypes: [
            "contacts.CREATED",
          ],
          executeUrl:
            "https://unify.apideck.com/webhook/w/{lookupIdToken}/{serviceId}?e={downstreamEventType}",
          createdAt: "2020-10-01T12:00:00.000Z",
        },
      ],
      hasGuide: true,
      createdAt: 1615563533390,
      customMappings: [
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
        {
          id: "hris+employees+first_aid_training",
          label: "First Aid Training",
          description: "First Aid Training completed after 2019-01-01",
          value: "$.root.training.first_aid",
          key: "first_aid_training",
          required: false,
          customField: true,
          consumerId: "test_user_id",
          example: "Some value",
        },
      ],
      updatedAt: 1616662325753,
    },
  });
});
