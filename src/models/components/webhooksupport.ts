/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v3";
import { remap as remap$ } from "../../lib/primitives.js";
import { safeParse } from "../../lib/schemas.js";
import { ClosedEnum } from "../../types/enums.js";
import { Result as SafeParseResult } from "../../types/fp.js";
import { SDKValidationError } from "../errors/sdkvalidationerror.js";

/**
 * Mode of the webhook support.
 */
export const Mode = {
  Native: "native",
  Virtual: "virtual",
  None: "none",
} as const;
/**
 * Mode of the webhook support.
 */
export type Mode = ClosedEnum<typeof Mode>;

/**
 * Received events are scoped to connection or across integration.
 */
export const SubscriptionLevel = {
  Connection: "connection",
  Integration: "integration",
} as const;
/**
 * Received events are scoped to connection or across integration.
 */
export type SubscriptionLevel = ClosedEnum<typeof SubscriptionLevel>;

/**
 * How the subscription is managed in the downstream.
 */
export const ManagedVia = {
  Manual: "manual",
  Api: "api",
} as const;
/**
 * How the subscription is managed in the downstream.
 */
export type ManagedVia = ClosedEnum<typeof ManagedVia>;

/**
 * The window unit for the rate.
 */
export const Unit = {
  Second: "second",
  Minute: "minute",
  Hour: "hour",
  Day: "day",
} as const;
/**
 * The window unit for the rate.
 */
export type Unit = ClosedEnum<typeof Unit>;

/**
 * The rate at which requests for resources will be made to downstream.
 */
export type RequestRate = {
  /**
   * The number of requests per window unit.
   */
  rate: number;
  /**
   * Size of request window.
   */
  size: number;
  /**
   * The window unit for the rate.
   */
  unit: Unit;
};

export type WebhookSupportResources = {
  events?: Array<string> | undefined;
};

/**
 * Virtual webhook config for the connector.
 */
export type VirtualWebhooks = {
  /**
   * The rate at which requests for resources will be made to downstream.
   */
  requestRate: RequestRate;
  /**
   * The resources that will be requested from downstream.
   */
  resources?: { [k: string]: WebhookSupportResources } | undefined;
};

/**
 * How webhooks are supported for the connector. Sometimes the connector natively supports webhooks, other times Apideck virtualizes them based on polling.
 */
export type WebhookSupport = {
  /**
   * Mode of the webhook support.
   */
  mode?: Mode | undefined;
  /**
   * Received events are scoped to connection or across integration.
   */
  subscriptionLevel?: SubscriptionLevel | undefined;
  /**
   * How the subscription is managed in the downstream.
   */
  managedVia?: ManagedVia | undefined;
  /**
   * Virtual webhook config for the connector.
   */
  virtualWebhooks?: VirtualWebhooks | undefined;
};

/** @internal */
export const Mode$inboundSchema: z.ZodNativeEnum<typeof Mode> = z.nativeEnum(
  Mode,
);

/** @internal */
export const SubscriptionLevel$inboundSchema: z.ZodNativeEnum<
  typeof SubscriptionLevel
> = z.nativeEnum(SubscriptionLevel);

/** @internal */
export const ManagedVia$inboundSchema: z.ZodNativeEnum<typeof ManagedVia> = z
  .nativeEnum(ManagedVia);

/** @internal */
export const Unit$inboundSchema: z.ZodNativeEnum<typeof Unit> = z.nativeEnum(
  Unit,
);

/** @internal */
export const RequestRate$inboundSchema: z.ZodType<
  RequestRate,
  z.ZodTypeDef,
  unknown
> = z.object({
  rate: z.number().int(),
  size: z.number().int(),
  unit: Unit$inboundSchema,
});

export function requestRateFromJSON(
  jsonString: string,
): SafeParseResult<RequestRate, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => RequestRate$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'RequestRate' from JSON`,
  );
}

/** @internal */
export const WebhookSupportResources$inboundSchema: z.ZodType<
  WebhookSupportResources,
  z.ZodTypeDef,
  unknown
> = z.object({
  events: z.array(z.string()).optional(),
});

export function webhookSupportResourcesFromJSON(
  jsonString: string,
): SafeParseResult<WebhookSupportResources, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => WebhookSupportResources$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'WebhookSupportResources' from JSON`,
  );
}

/** @internal */
export const VirtualWebhooks$inboundSchema: z.ZodType<
  VirtualWebhooks,
  z.ZodTypeDef,
  unknown
> = z.object({
  request_rate: z.lazy(() => RequestRate$inboundSchema),
  resources: z.record(z.lazy(() => WebhookSupportResources$inboundSchema))
    .optional(),
}).transform((v) => {
  return remap$(v, {
    "request_rate": "requestRate",
  });
});

export function virtualWebhooksFromJSON(
  jsonString: string,
): SafeParseResult<VirtualWebhooks, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => VirtualWebhooks$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'VirtualWebhooks' from JSON`,
  );
}

/** @internal */
export const WebhookSupport$inboundSchema: z.ZodType<
  WebhookSupport,
  z.ZodTypeDef,
  unknown
> = z.object({
  mode: Mode$inboundSchema.optional(),
  subscription_level: SubscriptionLevel$inboundSchema.optional(),
  managed_via: ManagedVia$inboundSchema.optional(),
  virtual_webhooks: z.lazy(() => VirtualWebhooks$inboundSchema).optional(),
}).transform((v) => {
  return remap$(v, {
    "subscription_level": "subscriptionLevel",
    "managed_via": "managedVia",
    "virtual_webhooks": "virtualWebhooks",
  });
});

export function webhookSupportFromJSON(
  jsonString: string,
): SafeParseResult<WebhookSupport, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => WebhookSupport$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'WebhookSupport' from JSON`,
  );
}
